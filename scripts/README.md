# Scripts

## sync-export-docs.js

Pulls the markdown export-format docs from the **core** repo into the docs site so the vulnerability intelligence and IOC intelligence format docs stay in sync.

**Source:** `core/docs/gen/exports/vuln_intel_format.md` and `core/docs/gen/exports/ioc_intel_format.md`  
**Output:** `build/exports/vuln-intel-format.mdx` and `build/exports/ioc-intel-format.mdx`

### Usage

From the **mintlify-docs** repo root:

```bash
# Copy current export docs from core (core must be at ../core, or set CORE_DIR)
node scripts/sync-export-docs.js

# Regenerate vuln intel docs in core first, then copy (requires core repo with pdm)
node scripts/sync-export-docs.js --regenerate
```

### Options

- **`--regenerate`** – Run `pdm run python docs/gen/exports/generate.py --output-dir docs/gen/exports/` in the core repo before copying. Use this after changing vuln intel export models so the markdown is fresh. (IOC format doc is not generated by that script; it is copied as-is from core.)

### Environment

- **`CORE_DIR`** – Path to the core repo root (default: `../core` relative to mintlify-docs). Set this if core lives elsewhere, e.g. `CORE_DIR=/path/to/core node scripts/sync-export-docs.js`.

### When to run

- After pulling core changes that touch `core/docs/gen/exports/` or vuln intel export models.
- Before publishing docs if you want the latest export format docs in the site.

---

## notify-changelog-to-slack.js

When the changelog page (`changelog.mdx`) is updated, posts the latest timeline section to Slack (internal and community webhooks). Uses **git history** to detect changes (no hash file). Used in GitHub Actions so that updates to the changelog trigger a notification to the two changelog channels.

**Flow:** Check if `changelog.mdx` changed between two git refs (e.g. before/after push, or `HEAD^`/`HEAD`). If changed (or `--force`): extract latest month section, POST to both webhooks. No file is written; nothing to commit.

### Usage

From the **mintlify-docs** repo root:

```bash
# Post to Slack only if changelog changed in git (last commit or REF_BEFORE..REF_AFTER)
node scripts/notify-changelog-to-slack.js

# Post even if git says unchanged (e.g. to re-send latest section)
node scripts/notify-changelog-to-slack.js --force
```

### Environment

- **`INTERNAL_SLACK_WEBHOOK`** – Incoming webhook URL for internal #changelog.
- **`COMMUNITY_SLACK_WEBHOOK`** – Incoming webhook URL for community changelog.
- **`REF_BEFORE`** – (optional) Git ref before the push (e.g. `${{ github.event.before }}`). Used with `REF_AFTER` so the script detects changelog changes in the push.
- **`REF_AFTER`** – (optional) Git ref after the push (e.g. `${{ github.sha }}`). If both are set, the script checks `git diff REF_BEFORE REF_AFTER -- changelog.mdx`. If not set, uses `HEAD^` and `HEAD` (last commit only).

### GitHub Actions

Add a workflow that runs on push (e.g. to `main`). No need to commit any hash file.

Example job step (recommended: pass refs so any commit in the push that touched the changelog triggers a post):

```yaml
- name: Notify Slack on changelog update
  env:
    INTERNAL_SLACK_WEBHOOK: ${{ secrets.INTERNAL_SLACK_WEBHOOK }}
    COMMUNITY_SLACK_WEBHOOK: ${{ secrets.COMMUNITY_SLACK_WEBHOOK }}
    REF_BEFORE: ${{ github.event.before }}
    REF_AFTER: ${{ github.sha }}
  run: node scripts/notify-changelog-to-slack.js
```

To run only when `changelog.mdx` is in the set of changed files, use a path filter on the job or workflow (e.g. `paths: ['changelog.mdx']`).
